name: 'Check Generated Files'

on:
  pull_request_target:
    types:
      - opened
      - synchronize
      - labeled
      - unlabeled

permissions:
  contents: read
  pull-requests: write

concurrency:
  group: 'gencheck-${{ github.event.pull_request.number }}'
  cancel-in-progress: true

jobs:
  check-generated:
    name: 'Detect Generated File Edits'
    runs-on: 'ubuntu-latest'
    steps:
      - name: 'Checkout'
        uses: 'actions/checkout@v4'

      - name: 'Check for Generated Files'
        uses: ./gencheck
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          file_patterns: '**/*.go,**/*.pb.go'
          marker_patterns: 'Code generated.*DO NOT EDIT,Code generated from.*specification'
          skip_label: 'skip: gencheck'
          post_comment: 'true'
          fail_on_detected: 'true'
          comment_template: |
            ## ðŸ¤– Generated Code Modified
            
            This PR modifies **{{file_count}}** generated file(s):
            
            {{file_list}}
            
            ### What should I do?
            
            Generated files are typically auto-generated and manual edits may be lost on regeneration.
            
            **Options:**
            - âœ… Add the `{{skip_label}}` label if these changes are intentional
            - ðŸ’¬ [Open an issue](https://github.com/{{owner}}/{{repo}}/issues/new) to discuss if you're unsure
            
            _This check can be bypassed by adding the skip label to PR #{{pr_number}}_

