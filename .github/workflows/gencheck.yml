name: 'Check Generated Files'

on:
  pull_request_target:
    types:
      - opened
      - synchronize
      - labeled
      - unlabeled

permissions:
  contents: read
  pull-requests: write

concurrency:
  group: 'gencheck-${{ github.event.pull_request.number }}'
  cancel-in-progress: true

jobs:
  check-generated:
    name: 'Detect Generated File Edits'
    runs-on: 'ubuntu-latest'
    steps:
      - name: 'Checkout'
        uses: 'actions/checkout@v4'

      - name: 'Check for Generated Files'
        uses: ./gencheck
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          file_patterns: '**/*.go,**/*.pb.go'
          marker_patterns: 'Code generated.*DO NOT EDIT,Code generated from.*specification'
          skip_label: 'skip: gencheck'
          post_comment: 'true'
          fail_on_detected: 'true'
          comment_header: '⚠️ Generated Files Modified'

